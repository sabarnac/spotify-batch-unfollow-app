"use strict";(self.webpackChunkspotify_batch_unfollow_app=self.webpackChunkspotify_batch_unfollow_app||[]).push([[214],{39:(e,s,l)=>{l.r(s),l.d(s,{default:()=>U});var t=l(43),o=l(752),n=l(379),a=l(90),i=l(600),r=l.n(i);const c=l.p+"static/media/default.b315bfa5ca1ef960e55f.png",d=l.p+"static/media/spotify-logo.0c4ae91bae23217d39c9.png";var u=l(579);const f=e=>{var s,l;let{follow:t,status:n,onClick:a,description:i}=e;return(0,u.jsxs)("div",{className:r()("follow",n,{clickable:!!a}),onClick:e=>{if(!e.target.classList.contains("follow-link")&&!e.target.classList.contains("spotify-link-logo"))return null===a||void 0===a?void 0:a()},children:[(0,u.jsx)("div",{className:"avatar",children:(0,u.jsx)("img",{src:null!==(s=null===(l=t.images[0])||void 0===l?void 0:l.url)&&void 0!==s?s:c,alt:`${t.name} Avatar`})}),(0,u.jsx)("h3",{className:"name",children:t.name}),(0,u.jsx)("div",{className:"type",children:o.xJ[t.type]}),(0,u.jsxs)("a",{className:"follow-link",href:t.external_urls.spotify,target:"_blank",rel:"noopener noreferrer",children:["View on ",(0,u.jsx)("img",{className:"spotify-link-logo",src:d,alt:"Spotify Logo"})]}),i&&(0,u.jsx)("div",{className:"description",children:i})]})},h=e=>{let{value:s,placeholder:l,onChange:t}=e;return(0,u.jsx)("input",{type:"text",placeholder:l,value:s,onChange:e=>t(e.target.value)})};var w=l(408),m=l(127);const p=e=>{let{options:s,value:l,disabled:t=!1,onChange:o}=e;return(0,u.jsx)(w.Ay,{styles:{option:(e,s)=>({...e,background:s.isFocused?"#282828":"#121212",color:"#d8f3e0"}),control:e=>({...e,border:"1px solid #d8f3e0",background:"#121212",borderRadius:"0"}),menu:e=>({...e,background:"#121212",border:"1px solid #d8f3e0"}),singleValue:e=>({...e,color:"#d8f3e0"}),valueContainer:e=>({...e})},captureMenuScroll:!1,isDisabled:t,value:s.find(e=>e.id===l),onChange:e=>(e=>"object"===typeof e&&!(0,m.h)(e)&&"id"in e&&"label"in e)(e)&&(null===o||void 0===o?void 0:o(e.id)),options:s})};var v=l(481),y=l(419);let g=function(e){return e[e.FIFTY=50]="FIFTY",e[e.TWENTY_FIVE=25]="TWENTY_FIVE",e[e.TEN=10]="TEN",e}({});const x=[{label:g.TEN,id:g.TEN},{label:g.TWENTY_FIVE,id:g.TWENTY_FIVE},{label:g.FIFTY,id:g.FIFTY}],j=e=>{let{followTypes:s,setFollowTypes:l,viewSize:n,setViewSize:a,filterString:i,setFilterString:r,allFilteredFollowsSelected:c,selectAllFilteredFollows:d,unselectAllFilteredFollows:f}=e;const{permissions:w}=(0,t.useContext)(v.A);return(0,u.jsxs)("div",{className:"follow-list-options",children:[(0,u.jsx)("h2",{children:"Options"}),(0,u.jsxs)("div",{className:"type-option",children:[(0,u.jsx)("span",{children:"Types:"}),o.Tc.filter(e=>{let{permission:s}=e;return w.has(s)}).map(e=>(0,u.jsx)("div",{className:`option-${e.id}`,children:(0,u.jsxs)("label",{children:[(0,u.jsx)(y.A,{checked:s.includes(e.id),disabled:s.includes(e.id)&&1===s.length,onChange:t=>t?null===l||void 0===l?void 0:l(...new Set([...s,e.id])):null===l||void 0===l?void 0:l(...new Set(s.filter(s=>s!==e.id)))}),(0,u.jsx)("span",{children:e.label})]})},e.id))]}),(0,u.jsx)("hr",{}),(0,m.h)(i)||(0,m.h)(r)?null:(0,u.jsx)("div",{className:"filter-option",children:(0,u.jsxs)("label",{children:[(0,u.jsx)("span",{children:"Search:"}),(0,u.jsx)(h,{value:i,onChange:r})]})}),(0,u.jsx)("div",{className:"view-option",children:(0,u.jsxs)("label",{children:[(0,u.jsx)("span",{children:"Results per page:"}),(0,u.jsx)(p,{value:n,onChange:a,options:x})]})}),(0,u.jsx)("button",{className:"warning",onClick:()=>{null===r||void 0===r||r(""),a(g.TEN)},children:"Reset filters"}),(0,m.h)(c)||(0,m.h)(d)||(0,m.h)(f)?null:(0,u.jsx)("button",{className:"success",onClick:c?f:d,children:c?"De-select filtered entries":"Select filtered entries"})]})},E=e=>{let{followTypes:s,follows:l,unfollowing:o,completed:n,header:i}=e;const[r,c]=(0,t.useState)(g.TEN),[d,h]=(0,t.useState)(0);(0,t.useEffect)(()=>{h(0)},[r]),(0,t.useEffect)(()=>{n&&h(0)},[n]);const w=l.filter(e=>"failed"===e.status),m=n&&w.length>0?w:l;return(0,u.jsx)("div",{className:"unfollow-follows-list",children:(0,u.jsxs)("div",{className:"results-table",children:[(0,u.jsx)("div",{className:"results-table-options",children:(0,u.jsx)(j,{followTypes:s,viewSize:r,setViewSize:c})}),(0,u.jsxs)("div",{className:"results-view",children:[i,o&&(0,u.jsx)(a.A,{}),(0,u.jsx)("div",{className:"follow-list",children:m.slice(d*r,(d+1)*r).map(e=>{return(0,u.jsx)(f,{status:e.status,follow:e.follow,description:(s=e,"failed"===s.status?`Could not unfollow. Error: ${e.error.message}`:void 0)},e.follow.id);var s})}),(0,u.jsxs)("div",{className:"pagination",children:[(0,u.jsx)("button",{className:"previous",onClick:()=>h(e=>e-1),disabled:0===d,children:"Previous"}),(0,u.jsx)("button",{className:"next",onClick:()=>h(e=>e+1),disabled:(d+1)*r>=l.length-1,children:"Next"})]})]})]})})},N=e=>({follow:e,status:"selected"}),b=e=>({follow:e,status:"succeeded"}),T=e=>({...e,status:"failed"}),S=e=>{let{followTypes:s,follows:l,onComplete:a}=e;const[i,r]=(0,t.useState)([]),[c,d]=(0,t.useState)([]),f=(0,t.useCallback)(e=>{(0,o.$y)(e)?d(s=>[...s,...e.succeeded]):r(s=>[...s,...e.failed.map(s=>({follow:s,error:e.error}))])},[d,r]),[h,w,m]=(0,n.KM)(l,f);return(0,t.useEffect)(()=>{const e=i.length+c.length;0===m.length&&!w&&h&&e===l.length&&a()},[m,w,h,a,i,c,l]),(0,u.jsx)("div",{className:"unfollow-all-list",children:(0,u.jsx)(E,{followTypes:s,follows:[...i.map(T),...l.filter(e=>!i.find(s=>s.follow.id===e.id)).filter(e=>-1===c.indexOf(e)).map(N),...c.map(b)],unfollowing:0===m.length&&w,completed:0===m.length&&!w&&!!h,header:(0,u.jsxs)(u.Fragment,{children:[m.length>0&&(0,u.jsxs)("div",{className:"error loading-message",children:["Error unfollowing ",(0,o.NI)(o.AD,...s),":",(0,u.jsx)("ul",{children:m.map((e,s)=>(0,u.jsx)("li",{children:e.message},s))})]}),0===m.length&&w&&(0,u.jsxs)("div",{className:"warning loading-message",children:["Unfollowing ",(0,o.NI)(o.AD,...s)]}),0===m.length&&!w&&h.length>0&&0===i.length&&(0,u.jsxs)("div",{className:"success loading-message",children:["Unfollowed all ",(0,o.NI)(o.AD,...s),"!"]}),0===m.length&&!w&&h.length>0&&i.length>0&&(0,u.jsxs)("div",{className:"error loading-message",children:["Could not unfollow some ",(0,o.NI)(o.AD,...s),"! Failed"," ",(0,o.NI)(o.AD,...s)," listed below"]})]})})})},F=e=>{let{followTypes:s,follows:l,restartUnfollow:n}=e;const[a,i]=(0,t.useState)(!1);return(0,u.jsxs)("div",{className:"follows-remove",children:[(0,u.jsx)(S,{followTypes:s,follows:l,onComplete:()=>i(!0)}),a&&(0,u.jsx)("div",{className:"restart-unfollow",children:(0,u.jsxs)("button",{className:"info",disabled:!a,onClick:n,children:["Unfollow more ",(0,o.NI)(o.AD,...s)]})})]})},C=()=>(0,u.jsxs)("div",{className:"list-legend",children:[(0,u.jsxs)("div",{className:"item normal",children:[(0,u.jsx)("div",{className:"color"}),(0,u.jsx)("div",{className:"text",children:"Not Selected"})]}),(0,u.jsxs)("div",{className:"item selected",children:[(0,u.jsx)("div",{className:"color"}),(0,u.jsx)("div",{className:"text",children:"Selected"})]})]}),A=e=>{let{loading:s,followTypes:l,follows:n,selectedFollows:i,setFollowTypes:r,addFollows:c,removeFollows:d}=e;const[h,w]=(0,t.useState)(g.TEN),[m,p]=(0,t.useState)(""),[v,y]=(0,t.useState)(0),x=(0,t.useMemo)(()=>n.filter(e=>""===m||e.name.toLowerCase().includes(m.toLowerCase())).map(e=>({follow:e,isSelected:-1!==i.indexOf(e)})),[n,m,i]),E=(0,t.useMemo)(()=>x.every(e=>{let{isSelected:s}=e;return s}),[x]),N=(0,t.useCallback)(()=>c(...x.map(e=>{let{follow:s}=e;return s})),[x,c]),b=(0,t.useCallback)(()=>d(...x.map(e=>{let{follow:s}=e;return s})),[x,d]);return(0,t.useEffect)(()=>{y(0)},[h,m]),(0,u.jsx)("div",{className:"all-follows-list",children:(0,u.jsxs)("div",{className:"results-table",children:[(0,u.jsx)("div",{className:"results-table-options",children:(0,u.jsx)(j,{followTypes:l,setFollowTypes:r,viewSize:h,setViewSize:w,filterString:m,setFilterString:p,allFilteredFollowsSelected:E,selectAllFilteredFollows:N,unselectAllFilteredFollows:b})}),(0,u.jsxs)("div",{className:"results-view",children:[(0,u.jsxs)("h2",{className:"list-title",children:["Select ",(0,o.NI)(o.AD,...l)," to unfollow"]}),(0,u.jsx)(C,{}),s&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("div",{className:"warning loading-message",children:["Retrieving followed ",(0,o.NI)(o.AD,...l)]}),(0,u.jsx)(a.A,{})]}),(0,u.jsxs)("div",{className:"artist-list",children:[!s&&0===n.length&&(0,u.jsxs)("div",{className:"error loading-message",children:["No followed ",(0,o.NI)(o.AD,...l)," found"]}),x.slice(v*h,(v+1)*h).map(e=>{let{isSelected:s,follow:l}=e;return(0,u.jsx)(f,{status:s?"selected":void 0,follow:l,onClick:()=>s?d(l):c(l)},l.id)})]}),(0,u.jsxs)("div",{className:"pagination",children:[(0,u.jsx)("button",{className:"previous",onClick:()=>y(e=>e-1),disabled:0===v,children:"Previous"}),(0,u.jsx)("button",{className:"next",onClick:()=>y(e=>e+1),disabled:(v+1)*h>=n.length-1,children:"Next"})]})]})]})})},k=e=>{let{followTypes:s,setFollowTypes:l,selectedFollows:t,addFollowsForRemoval:a,removeFollowsFromRemoval:i}=e;const[r,c,d]=(0,n.pn)(s,a);return(0,u.jsxs)("div",{className:"all-follows",children:[d.length>0&&(0,u.jsxs)("div",{className:"error loading-message",children:["Error retrieving followed ",(0,o.NI)(o.AD,...s),":",(0,u.jsx)("ul",{children:d.map((e,s)=>(0,u.jsx)("li",{children:e.message},s))})]}),(0,u.jsx)(A,{loading:c,followTypes:s,setFollowTypes:l,follows:r,selectedFollows:t,addFollows:a,removeFollows:i})]})},_=e=>{let{followTypes:s,setFollowTypes:l,selectedFollows:t,addFollows:n,removeFollows:a,startUnfollow:i}=e;return(0,u.jsxs)("div",{className:"follows-select",children:[(0,u.jsx)(k,{followTypes:s,setFollowTypes:l,selectedFollows:t,addFollowsForRemoval:n,removeFollowsFromRemoval:a}),(0,u.jsx)("div",{className:"start-unfollow",children:(0,u.jsxs)("button",{className:r()("error",{disabled:0===t.length}),disabled:0===t.length,onClick:i,children:["Unfollow ",t.length," ",(0,o.NI)(o.AD,...s)]})})]})};var I=function(e){return e.SELECT="select",e.REMOVE="remove",e}(I||{});const U=()=>{const{permissions:e}=(0,t.useContext)(v.A),[s,l]=(0,t.useState)(new Set([...e].map(e=>o.Tc.find(s=>s.permission===e)).map(e=>null===e||void 0===e?void 0:e.id))),[n,a]=(0,t.useState)(I.SELECT),[i,r]=(0,t.useState)(new Set),c=(0,t.useMemo)(()=>[...s],[s]);(0,t.useEffect)(()=>{r(e=>([...e].filter(e=>!(0,o.or)(...s).includes(e.type)).forEach(s=>e.delete(s)),new Set(e)))},[s,r]);const d=(0,t.useCallback)(function(){for(var e=arguments.length,s=new Array(e),t=0;t<e;t++)s[t]=arguments[t];l(new Set(s))},[l]),f=(0,t.useCallback)(function(){for(var e=arguments.length,s=new Array(e),l=0;l<e;l++)s[l]=arguments[l];return r(e=>(s.forEach(s=>e.add(s)),new Set(e)))},[r]),h=(0,t.useCallback)(function(){for(var e=arguments.length,s=new Array(e),l=0;l<e;l++)s[l]=arguments[l];return r(e=>(s.forEach(s=>e.delete(s)),new Set(e)))},[r]);return(0,u.jsx)("div",{className:"unfollow-follows",children:n===I.SELECT?(0,u.jsx)(_,{followTypes:c,setFollowTypes:d,selectedFollows:[...i],addFollows:f,removeFollows:h,startUnfollow:()=>a(I.REMOVE)}):(0,u.jsx)(F,{followTypes:c,follows:[...i],restartUnfollow:()=>{r(new Set),a(I.SELECT)}})})}},127:(e,s,l)=>{l.d(s,{h:()=>t});const t=e=>null===e||void 0===e},379:(e,s,l)=>{l.d(s,{pn:()=>Y,_d:()=>R,KM:()=>O});var t=l(43);const o=function(e,s){for(var l=arguments.length,o=new Array(l>2?l-2:0),n=2;n<l;n++)o[n-2]=arguments[n];const[a,i]=(0,t.useState)(),[r,c]=(0,t.useState)(),[d,u]=(0,t.useState)(!1);return(0,t.useEffect)(()=>{if(!s)return;u(!0),i(void 0),c(void 0);let l=!1;return(async()=>{try{const s=await e(...o);l||i(s),u(!1)}catch(r){const s=r;"AbortError"===s.name||l||c(s),u(!1)}})(),()=>{l=!0}},[e,s,...o]),[a,d,r]},n=function(e,s){for(var l=arguments.length,o=new Array(l>2?l-2:0),n=2;n<l;n++)o[n-2]=arguments[n];const[a,i]=(0,t.useState)([]),[r,c]=(0,t.useState)(),[d,u]=(0,t.useState)(!1);return(0,t.useEffect)(()=>{if(!s)return;u(!0),i([]),c(void 0);let l=!1;return(async()=>{try{for await(const s of e(...o)){if(u(!0),l)break;i(e=>[...e,s])}u(!1)}catch(r){const s=r;"AbortError"===s.name||l||c(s),u(!1)}})(),()=>{l=!0}},[e,s,...o]),[a,d,r]};var a=l(127),i=l(154);const r=e=>e.json();class c extends Error{constructor(e,s,l){super(`Error has occurred performing the request due to error: ${s} [Status Code: ${e}]`),this._status=void 0,this._body=void 0,this._headers=void 0,this._status=e,this._body=s,this._headers=l}get status(){return this._status}get body(){return this._body}get headers(){return this._headers}}const d=async(e,s,l,t,o,n,a)=>{l.ok?e(l):t.attemptCount<t.maxAttemptCount&&f(l.status,a)?(t.attemptCount++,u(e,s,l,t,o,n,a)):s(new c(l.status,(await l.json()).error.message,l.headers))},u=(e,s,l,t,o,n,a)=>{setTimeout(async()=>{let l=await fetch(o,n);d(e,s,l,t,o,n,a)},((e,s)=>{const l=e.headers.get("Retry-After")||"0";return Math.max(1e3*Math.pow(2,s.attemptCount-1),Number(l))})(l,t))},f=(e,s)=>e>=500||s&&s.indexOf(e)>=0,h=async(e,s,l)=>new Promise(async(t,o)=>{d(t,o,await fetch(e,s),{attemptCount:0,maxAttemptCount:3},e,s,l)}),w=async(e,s,l,t,o)=>{const n=[i.sH,...e].join("/")+"/",r=(c=s)?"?"+Object.keys(c).filter(e=>!(0,a.h)(c[e])).map(e=>`${e}=${encodeURIComponent(c[e])}`).join("&"):"";var c;return h(n+r,((e,s,l)=>({headers:{Authorization:`Bearer ${i.Ay.userToken}`,...s},body:e,method:l}))(l,t,o),[429]).catch(e=>{throw 401!==e.status||i.Ay.resetToken(),e})},m=async(e,s,l)=>{const t=await r(await w(["me","following"],{type:e,limit:s,after:l}));return"artist"===e?t.artists:t.users},p=e=>"user"===e.type,v=async function*(e){let s;do{const l=await m(e,i.BU,s);yield l.items.map(e=>p(e)?{...e,name:e.display_name}:e),s=l.cursors.after}while(!(0,a.h)(s))},y=async(e,s)=>await r(await w(["me","shows"],{limit:e,offset:s})),g=async function*(){let e;do{const s=await y(i.BU,e);yield s.items.map(e=>{let{show:s}=e;return s}),e=s.offset+s.limit,e>=s.total&&(e=void 0)}while(!(0,a.h)(e))},x=async()=>r(await w(["me"])),j=(e,s)=>{let l=[];for(let t=0;t<e.length;t+=s)l.push(e.slice(t,Math.min(e.length,t+s)));return l},E=async e=>await w(["me","following"],{type:"artist",ids:e.map(e=>e.id).join(",")},null,{"Content-Type":"application/json"},"DELETE"),N=async function*(e){for(const l of j(e,i.BU))try{await E(l),yield{succeeded:l}}catch(s){yield{failed:l,error:s}}},b=async e=>await w(["me","shows"],{ids:e.map(e=>e.id).join(",")},null,{"Content-Type":"application/json"},"DELETE"),T=async function*(e){for(const l of j(e,i.BU))try{await b(l),yield{succeeded:l}}catch(s){yield{failed:l,error:s}}},S=async e=>await w(["me","following"],{type:"user",ids:e.map(e=>e.id).join(",")},null,{"Content-Type":"application/json"},"DELETE"),F=async function*(e){for(const l of j(e,i.BU))try{await S(l),yield{succeeded:l}}catch(s){yield{failed:l,error:s}}};var C=l(752);const A=async(e,s)=>await r(await w(["me","albums"],{limit:e,offset:s})),k=async function*(){let e;do{const s=await A(i.BU,e);yield s.items.map(e=>{let{album:s}=e;return s}),e=s.offset+s.limit,e>=s.total&&(e=void 0)}while(!(0,a.h)(e))},_=async e=>await w(["me","albums"],{ids:e.map(e=>e.id).join(",")},null,{"Content-Type":"application/json"},"DELETE"),I=async function*(e){for(const l of j(e,i.BU))try{await _(l),yield{succeeded:l}}catch(s){yield{failed:l,error:s}}},U=async(e,s,l)=>await r(await w(["me","playlists"],{limit:s,offset:l})),D=async function*(){const e=await x();let s;do{const l=await U(e,i.BU,s);yield l.items.filter(s=>{let{owner:{id:l}}=s;return l!==e.id}),s=l.offset+l.limit,s>=l.total&&(s=void 0)}while(!(0,a.h)(s))},L=async e=>await w(["playlists",e.id,"followers"],void 0,null,{"Content-Type":"application/json"},"DELETE"),M=async function*(e){for(const l of e)try{await L(l),yield{succeeded:[l]}}catch(s){yield{failed:[l],error:s}}},R=function(){return o(x,!(arguments.length>0&&void 0!==arguments[0])||arguments[0])},V=(e,s,l)=>{if(0===l.length)return;const t=l[l.length-1];e(e=>[...e,...t]),s(...t)},B=(e,s)=>{s&&e(e=>[...e,s])},Y=function(e,s){let l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const[o,a,i]=n(v,l&&e.includes("ARTIST"),"artist"),[r,c,d]=n(v,l&&e.includes("USER"),"user"),[u,f,h]=n(g,l&&e.includes("SHOW")),[w,m,p]=n(k,l&&e.includes("ALBUM")),[y,x,j]=n(D,l&&e.includes("PLAYLIST")),[E,N]=(0,t.useState)([]);(0,t.useEffect)(()=>V(N,s,o),[o,s,N]),(0,t.useEffect)(()=>V(N,s,r),[r,s,N]),(0,t.useEffect)(()=>V(N,s,u),[u,s,N]),(0,t.useEffect)(()=>V(N,s,w),[w,s,N]),(0,t.useEffect)(()=>V(N,s,y),[y,s,N]);const[b,T]=(0,t.useState)([]);return(0,t.useEffect)(()=>B(T,i),[i,T]),(0,t.useEffect)(()=>B(T,d),[d,T]),(0,t.useEffect)(()=>B(T,h),[h,T]),(0,t.useEffect)(()=>B(T,p),[p,T]),(0,t.useEffect)(()=>B(T,j),[j,T]),(0,t.useEffect)(()=>{const s=(0,C.or)(...e);N(e=>e.filter(e=>{let{type:l}=e;return s.includes(l)}))},[e,N,T]),[E,a||c||f||m||x,b]},$=(e,s,l)=>{if(0===l.length)return;const t=l[l.length-1];e(e=>[...e,t]),s(t)},O=function(e,s){let l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const o=(0,t.useMemo)(()=>e.filter(e=>"artist"===e.type),[e]),a=(0,t.useMemo)(()=>e.filter(e=>"user"===e.type),[e]),i=(0,t.useMemo)(()=>e.filter(e=>"show"===e.type),[e]),r=(0,t.useMemo)(()=>e.filter(e=>"album"===e.type),[e]),c=(0,t.useMemo)(()=>e.filter(e=>"playlist"===e.type),[e]),[d,u,f]=n(N,l,o),[h,w,m]=n(F,l,a),[p,v,y]=n(T,l,i),[g,x,j]=n(I,l,r),[E,b,S]=n(M,l,c),[C,A]=(0,t.useState)([]);(0,t.useEffect)(()=>$(A,s,d),[d,s,A]),(0,t.useEffect)(()=>$(A,s,h),[h,s,A]),(0,t.useEffect)(()=>$(A,s,p),[p,s,A]),(0,t.useEffect)(()=>$(A,s,g),[g,s,A]),(0,t.useEffect)(()=>$(A,s,E),[E,s,A]);const[k,_]=(0,t.useState)([]);return(0,t.useEffect)(()=>B(_,f),[f,_]),(0,t.useEffect)(()=>B(_,m),[m,_]),(0,t.useEffect)(()=>B(_,y),[y,_]),(0,t.useEffect)(()=>B(_,j),[j,_]),(0,t.useEffect)(()=>B(_,S),[S,_]),[C,u||w||v||x||b,k]}}}]);
//# sourceMappingURL=214.997719f1.chunk.js.map